Modified code from the 'fast-build' mod as well as original code